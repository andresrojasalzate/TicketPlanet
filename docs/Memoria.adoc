= TICKETPLANET 
Adria Bernabeu, Salma Picazo, Andres Rojas

:toc-title: ÍNDICE
:figure-caption: Figura
:table-caption: Taula
:example-caption: Exemple
:doctype: book
:encoding: utf-8
:lang: es
:toc: left
:toclevels: 5
:sectnums:
:icons: font   
:numbered:

== INTRODUCCIÓN

*TicketPlanet*

image::Images/Logo.png[Logo principal, width=10%]

*Miembros*  

- Adria Bernabeu

- Salma Picazo

- Andres Rojas

=== Objetivo de la aplicación

== PLANIFICACIÓN Y SEGUIMIENTO

=== Semana 1

==== Salma
- Diseño Mockups pantalla home, versión movil y Web, Figma
- Implementación Header y Footer
- Diagrama de clases
- Diagrama entorno Docker
- Creación del Logo de la aplicación y favicon

==== Andres
- Diseño de la guia de estilos
- Configuración del Docker
- Congiguración de las migraciones 
- Configuración de los factorys y seeders 
- Función para mostrar todos los eventos en home
- Función para el buscador 
- Configuración del Isard

==== Adrian
- Diseño de la guia de estilos
- Diseño Mockups pantalla home, version movil y web
- Figma y trello
- Test funcionales

=== Semana 2

==== Salma
- Diseño Mockups pantalla Login, version movil y web, Figma
- Implementación Funcionalidad Login
- Diseño Mockups pantalla "Restablecer contraseña", versión movil y web, Figma
- Implementación Funcionalidad Cerrar Sesión.
- Arreglar CSS de la pantalla Home.

==== Andres
- Diseño de mockups para pantalla de movil y web de la nueva pantalla home
- Creación de la nueva tabla Cateorias y modificación de la base de datos para ajustarse a la nueva tabla
- Plantilla para las vistas de la web
- Funcion para mostar las categorias y sus eventos en la nueva pantalla home

==== Adrian
- Diseño de la pagina crear Esdeveniments en el figma version movil y web
- Implementacion funcionalidad de la pagina home Promotors
- Test funcionales

=== Semana 3

==== Salma
- Diseño Mockups pantalla Mostrar info evento, version movil y web, Figma
- Implementación Funcionalidad Restablecer contraseña
- Arreglar CSS de varias pantallas.
- Implementación Mostrar Información del Evento en pantalla "ShowEvent". (Pendiente implementación entradas, etc.).
- Modificadas migraciones de eventos y sesiones para funcionalidad Crear Eventos.

==== Andrés
- Diseño mockup para pantalla "Pàgina resum Llistat de sessions obertes"
- En crear evento funciónde poder seleccionar direcciones de eventos pasados. 
- Ajustes en el buscador
- Ajustes en la migración de eventos y sesiones 
- Ajustes en los factorys 

==== Adria
- Diseño pagina crear Esdeveniments version movil, web
- Funcionalidad pagina crear Esdeveniments
- Funcionalidad en crear Esdeveniments validacion  

=== Semana 4

==== Salma
- Modificar css pantalla Login
- Modifcar css pantalla recuperar contraseña
- Token no funciona, restablecer contraseña
- Modificar css header
- Modificar css footer
- Modificar css del menú desplegable
- Arreglar css Buscador pantalla home, etc.
- Acabar funcionalidad mostrar eventos, añadida lista entradas
- Funcionalidad administrar eventos
- Modificar Pantalla Home Promotor, añadidos botones
- Creación de Test, LoginTest

==== Andres 
- Funcion para subir imagen al crear evento
- Solucion de problema con la paginación en la pantalla de resultado de busqueda. 
- Implementación de la pantalla ""Pàgina resum Llistat de sessions obertes"
- Test de buscador y home. 

==== Adria
- Test funcionales en link controllers
- Modificar css pagina crear evento y entradas
- Mejorar funcionalidad crear evento y entradas
- Arreglar validaciones


=== Semana 5

==== Salma
- Creación de Test, ValoracionTest
- Diseño Mockups pantalla 'ShowEvent', mostrar valoraciones, versión Web
- Diseño Mockups pantalla 'ShowEvent', mostrar valoraciones, versión movil
- Diseño Mockups pantalla 'Compra', versión Web
- Implementación creación de correo electrónico para valorar evento
- Implementación creación del formulario para valorar evento
- Implementación mostrar las valoraciones en la pantalla de 'ShowEvents'
- Implementación pantalla 'Compra', mostrar contador 10 minutos.

==== Andrés
- Ajusts en tests
- Diseño de mockup de entradas
- Implementación de creación de entradas en pdf
- Ajustes en el buscador
- Ajuste en los factorys

==== Adria
- Mockups mejorados de crear evento y entrada version mobil y desktop
- Creacion pagina crear multiples sesiones
- Diseño pagina multiples sesiones, funcionamiento y validaciones 
- Creacion test funcionales en link controller

=== Semana 6

==== Salma
- Modificado css pantalla 'Home Promotor'
- Implementar botón accesible para la edición de eventos
- Diseño Mockups pantalla 'Compra', versión Web, Figma
- Diseño Mockups pantalla 'Compra', versión movil, Figma
- Creación de nueva tabla en la bbdd, 'Compra'
- Implementación de la funcionalidad de Compra. (Contar con entradas nominales, mostrados datos y guardado en base de datos)

==== Andrés
- Implementación SASS 7-1 pattern
- Implentación de crear entradas en pdf con información dinamica

==== Adria 
- Implementacion primera version SASS 
- Test funcionales de la parte de Tickets y controlador link
- Diseño Mockups feedback cuando compras entrada
- Implementacion feedback

=== Semana 7

==== Adria 
 - Implementacion de la funcionalidad de la  pasarela de pago 
 - Gestion de errores en el pago


== DISEÑO

=== Base de datos

[plantuml,,png]
----

class events{
id: int 
created_at: Timestamp
updated_at: Timestamp
name: string
description: string
address: string
imagen: string   
city: string
name_site: string  
finishDate: Date
finishTime: Time
visible: boolean
capacity: int
category_id: int
user_id: int     
}

class categories{
id: int                      
name: string
created_at: Timestamp
updated_at: Timestamp
}

class sessions{
id: int  
created_at: Timestamp
updated_at: Timestamp
date: Date
time: Time
maxCapacity: int
event_id: int
}

class tickets{
id: int      
created_at: Timestamp
updated_at: Timestamp
name: string
quantity: int
price: int
nominal: boolean
session_id: int
}   

class users{
id: int      
created_at: Timestamp
updated_at: Timestamp
name: string
email: string
email_verified_at: Timestamp
password: string
reset_token: string
remember_token: string
} 


events "0...n" -- "1" categories 
events "1" -- "1" users 
events "1" -- "0...n" sessions
sessions "1" -- "0...n" tickets 
----

=== Interfícies
    
==== Sketching

==== Figma
Link a las interfícies de Figma https://www.figma.com/file/V47MqQzp5biMSzsQ5m7gZU/Mockups?type=design&node-id=0-1&mode=design&t=IMIfO6zr6hBVFlYG-0[aquí]. 

=== Guía de estilos
Link a la guía de estilos de Figma https://www.figma.com/file/7RISOKUOjvDXdzufahisrv/Gu%C3%ADa-de-estilos?type=design&node-id=0%3A1&mode=design&t=QgHjfUcq2g73B829-1[aquí]. 

== MANUAL DE INSTALACIÓN SERVER

=== Paso 1: Instalar Apache

Instala Apache en tu servidor Debian

```bash
sudo apt update
sudo apt install apache2
```

Habilita el módulo de Apache necesario para ejecutar aplicaciones PHP.

```bash
sudo a2enmod php8.2
sudo systemctl restart apache2
```

=== Paso 2: Instalar PHP y Extensiones Necesarias

```bash
sudo apt install php7.4 sudo apt install php8.2-curl php8.2-dom php8.2-mbstring php8.2-xml php8.2-pgsql zip unzip
```

=== Paso 3: Descargar proyecto laravel

```bash
cd /var/www/
git pull https://git.copernic.cat/abernabeu/gr3-bernabeu-rojas-picazo.git
```
=== Paso 4: Configurar conexión a base de datos

```bash
cd /var/www/gr3-bernabeu-rojas-picazo/ticketplanet
cp .env.example .env
```
Modficar el archivo .env 

```bash
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=ticketplanet
DB_USERNAME=usuario
DB_PASSWORD=1234
```

Añadimos uns parámetros de configuración necesarios para el proyecto en el .env

```bash
PAGINATION_LIMIT=10
EVENT_LIMIT_HOME=6
PASARELA_PAGAMENT = true
API_LOCAL= false
```

=== Paso 6: Instalar Dependencias de Composer

Instala las dependencias de Composer para tu proyecto Laravel.

```bash
cd /var/www/gr3-bernabeu-rojas-picazo/ticketplanet
composer install --no-dev
```

=== Paso 7: Generar app key

```bash
cd /var/www/gr3-bernabeu-rojas-picazo/ticketplanet
php artisan key:generate
```

=== Paso 8: Dar permisos
```bash
cd /var/www/gr3-bernabeu-rojas-picazo/ticketplanet
chown -R www-data storage
chown -R www-data bootstrap/cache
```
```bash
chmod -R 755 storage
chmod -R 755 bootstrap/cache
```

=== Paso 9: Configurar Virtual Host de Apache

Crea un archivo de configuración de Virtual Host para tu proyecto Laravel

```bash
sudo nano /etc/apache2/sites-available/laravel.conf
```
Pon el siguiente contenido:

```bash
<VirtualHost *:80>
    ServerName ticket.com
    DocumentRoot /var/www/gr3-bernabeu-rojas-picazo/ticketplanet/public

    <Directory /var/www/gr3-bernabeu-rojas-picazo/ticketplanet/public>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/demo-error.log
    CustomLog ${APACHE_LOG_DIR}/demo-access.log combined
</VirtualHost>
```

Guarda y cierra el archivo. Luego, habilita el Virtual Host y reinicia Apache.

```bash
sudo a2ensite laravel
sudo systemctl restart apache2
```
=== Paso 10: Activar Docker
```bash
cd /var/www/gr3-bernabeu-rojas-picazo/docker/server
sudo docker compose up -d
```

=== Paso 11: Crear base de datos

```bash
cd /var/www/gr3-bernabeu-rojas-picazo/ticketplante
```

Ejecutamos el siguiente comando para crear base de datos.

```bash
sudo php artisan migrate
```

=== Paso 12: Instalar unaccent en Postgresql

Ejecutamos el siguiente comando para entrar a la terminal de postgresql 

```bash
sudo docker exec -it pg_container psql -U usuario  ticketplanet
```

Una vez en la terminal de postgresql ejecutamos el siguiente comando

```bash
CREATE EXTENSION unaccent;
```

=== Paso 13: Configurar docker con la base de datos del proyecto de la API

Accedemos a la carpeta api-imagenes y ejecutamos el siguiente comando:
```bash
cd api-imagenes
docker-compose up -d
```

=== Paso 14: Instalar composer en el proyecto de la api

```bash
cd api-imagenes/api-rest/
composer install
```

=== Paso 15: Configurar .env del proyecto api
Creamos el archivo .env

```bash
cd api-imagenes/api-rest/
cp .env.example .env
```
Editamos el archivo para congiurar el acceso a la base de datos en el proyecto

```bash
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=9001
DB_DATABASE=api-rest
DB_USERNAME=usuario
DB_PASSWORD=1234
```
Añadimos un ultimo parámetro para configurar el puerto del proyecto en el 9000

```bash
SERVER_PORT=9000
```
=== Paso 16: Generar app_key para el proyecto de la api 

```bash
cd api-imagenes/api-rest/
php artisan key:generate
```
=== Paso 17: Hacer la migracion del proyecto 

```bash
cd api-imagenes/api-rest/
php artisan migrate
```
=== Paso 17: Generar un token para acceder a la api desde la app
Accedemos al proyecto y ejecutamos el proyecto "php artisan db:seed"

```bash
cd api-imagenes/api-rest/
php artisan db:seed
```
El comando debolvera un token. Este token lo deberdemos poner en el archivo .env del proyecto ticketplanet de la siguiene manera:

```bash
cd ticketplanet/
```
archivo .env:
```bash
API_KEY="a9yKqIWD4hqiLdBA0sat7ogQOVIwiRGYsu51XNEOa3a582a5"
```
=== Paso 18:Cambiar permisos del proyecto de la API

```bash
cd /var/www/gr3-bernabeu-rojas-picazo/api-imagenes/api-rest/
chown -R www-data storage
chown -R www-data bootstrap/cache
```
```bash
chmod -R 755 storage
chmod -R 755 bootstrap/cache
```

=== Paso 19: Añadir el proyecto a la configuracion de apache

Primero añadiremos un nuevo virtual host en el archivo ticketplanet.conf

```bash
sudo nano /etc/apache2/sites-available/ticketplanet.conf
```

```bash
<VirtualHost *:8080>
    ServerName api-imagenes.com
    DocumentRoot /var/www/gr3-bernabeu-rojas-picazo/api-imagenes/api-rest/public

    <Directory /var/www/gr3-bernabeu-rojas-picazo/api-imagenes/api-rest/public>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/demo-error.log
    CustomLog ${APACHE_LOG_DIR}/demo-access.log combined
</VirtualHost>
```
Editamos el archivo ports.conf para configurar que el servicio de apache escuche el puerto 8080

```bash
sudo nano /etc/apache2/ports.conf
```
En el archivo ports.conf añadimos la siguiente linea:

```bash
Listen 8080
```

=== Paso 20: Activar API

Para que se pueda utilizar la API para guardar imagenes se tiene que activar el proyecto 

```bash
cd /var/www/gr3-bernabeu-rojas-picazo/api-imagenes/api-rest
```

```bash
sudo php artisan serve
```

== MANUAL DE INSTALACIÓN LOCAL

=== Paso 1: Descargar el proyecto de GitLab

```bash
git pull https://git.copernic.cat/abernabeu/gr3-bernabeu-rojas-picazo.git
```
=== Paso 2: Configurar docker con la base de datos del proyecto de la API

Accedemos a la carpeta api-imagenes y ejecutamos el siguiente comando:
```bash
cd api-imagenes
docker-compose up -d
```

=== Paso 3: Instalar composer en el proyecto de la api

```bash
cd api-imagenes/api-rest/
composer install
```

=== Paso 4: Configurar .env del proyecto api
Creamos el archivo .env

```bash
cd api-imagenes/api-rest/
cp .env.example .env
```
Editamos el archivo para congiurar el acceso a la base de datos en el proyecto

```bash
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=9001
DB_DATABASE=api-rest
DB_USERNAME=usuario
DB_PASSWORD=1234
```
Añadimos un ultimo parámetro para configurar el puerto del proyecto en el 9000

```bash
SERVER_PORT=9000
```
=== Paso 4: Generar app_key para el proyecto de la api 

```bash
cd api-imagenes/api-rest/
php artisan key:generate
```
=== Paso 5: Hacer la migracion del proyecto 

```bash
cd api-imagenes/api-rest/
php artisan migrate
```
=== Paso 6: Configurar docker con la base de datos del proyecto de la app

Accedemos a la carpeta docker/dev y ejecutamos el siguiente comando:
```bash
cd docker/dev
docker-compose up -d
```

=== Paso 7: Instalar composer en el proyecto de la app

```bash
cd ticketplanet/
composer install
```

=== Paso 8: Configurar .env del proyecto app
Creamos el archivo .env

```bash
cd ticketplanet/
cp .env.example .env
```
Editamos el archivo para congiurar el acceso a la base de datos en el proyecto

```bash
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=ticketplanet
DB_USERNAME=usuario
DB_PASSWORD=1234
```
Añadimos uns parámetros de configuración necesarios en el .env

```bash
PAGINATION_LIMIT=10
EVENT_LIMIT_HOME=6
PASARELA_PAGAMENT = true
API_LOCAL= true
```
=== Paso 9: Generar app_key para el proyecto de la app 

```bash
cd ticketplanet/
php artisan key:generate
```
=== Paso 10: Hacer la migracion del proyecto 

```bash
cd ticketplanet/
php artisan migrate
```

=== Paso 11: Instalar unaccent en Postgresql

Ejecutamos el siguiente comando para entrar a la terminal de postgresql 

```bash
sudo docker exec -it pg_container psql -U usuario  ticketplanet
```

Una vez en la terminal de postgresql ejecutamos el siguiente comando

```bash
CREATE EXTENSION unaccent;
```

=== Paso 12: Generar un token para acceder a la api desde la app
Accedemos al proyecto y ejecutamos el proyecto "php artisan db:seed"

```bash
cd api-imagenes/api-rest/
php artisan db:seed
```
El comando debolvera un token. Este token lo deberdemos poner en el archivo .env del proyecto ticketplanet de la siguiene manera:

```bash
cd ticketplanet/
```
archivo .env:
```bash
API_KEY="a9yKqIWD4hqiLdBA0sat7ogQOVIwiRGYsu51XNEOa3a582a5"
```

=== Paso 13: Activar el proyecto

Para activiar el proyecto primero activamos la API

```bash
cd api-imagenes/api-rest/
php artisan serve
```

Una vez activamos la API activamos activamos la app

```bash
cd ticketplanet/
php artisan serve
```
Y en el navegador buscamos 127.0.0.1:8000

== CONCLUSIÓN   

=== Líneas futuras

=== Webgrafia

=== Presentación
